<!DOCTYPE html>
<html lang="tr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Adres Y√∂netimi - eduyemek</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/ituyemek_logo.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <link rel="manifest" href="/manifest.json">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            font-size: clamp(14px, 2.5vw, 16px);
        }

        .hero-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(209, 213, 219, 0.3);
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }

        .restaurant-card {
            background: #fff;
            border-radius: 0.75rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            width: 100%;
            max-width: 20rem;
            height: auto;
            min-height: 12.5rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .restaurant-card:hover {
            transform: translateY(-0.25rem);
            box-shadow: 0 0.375rem 1.25rem rgba(0, 0, 0, 0.08);
        }

        .restaurant-card.closed {
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .restaurant-card.closed:hover {
            transform: none;
            box-shadow: none;
        }

        .restaurant-card img {
            width: 100%;
            height: 7.5rem;
            object-fit: cover;
            border-radius: 0.75rem 0.75rem 0 0;
            flex-shrink: 0;
        }

        .search-input {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            transition: border-color 0.2s, box-shadow 0.2s, transform 0.2s;
            font-size: clamp(14px, 2vw, 16px);
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
            touch-action: manipulation;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .btn-primary.active {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f43f5e, #fb923c);
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
            touch-action: manipulation;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(255, 216, 155, 0.4);
        }

        .btn-secondary.active {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .btn-secondary:active {
            transform: scale(0.95);
        }

        .btn-third {
            background: #e5e7eb;
            color: #374151;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
            touch-action: manipulation;
        }

        .btn-third:hover {
            transform: translateY(-1px);
            background: #d1d5db;
        }

        .address-dropdown {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(209, 213, 219, 0.3);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .notification-badge {
            background: linear-gradient(135deg, #ff0000 0%, #e14a14 100%);
            animation: bounce 2s infinite;
        }

        .notification {
            position: fixed;
            top: 0.75rem;
            right: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: linear-gradient(135deg, #10b981, #059669);
            font-weight: 500;
            transform: translateX(100%);
            transition: transform 0.2s ease-in-out;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            color: white;
            font-size: clamp(12px, 2vw, 14px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-toggle {
            background: #e5e7eb;
            color: #374151;
            border-radius: 8px;
            font-weight: 600;
            transition: background 0.2s, color 0.2s, transform 0.2s;
            padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
        }

        .btn-toggle.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
        }

        .btn-toggle:hover {
            transform: translateY(-1px);
            background: #d1d5db;
        }

        .btn-toggle.active:hover {
            background: linear-gradient(135deg, #5a6dd8, #6a3b92);
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        header.shrunk {
            padding: clamp(0.5rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        header.shrunk .header-logo {
            font-size: clamp(1.25rem, 3vw, 1.5rem);
        }

        header.shrunk .search-input {
            padding: clamp(0.5rem, 2vw, 0.75rem) clamp(0.75rem, 2.5vw, 1rem) clamp(0.5rem, 2vw, 0.75rem) clamp(2rem, 5vw, 2.5rem);
        }

        header.hidden {
            transform: translateY(-100%);
            transition: transform 0.3s;
        }

        #hamburgerMenu {
            transform: translateX(-100%);
            transition: transform 0.3s;
            width: clamp(200px, 75%, 300px);
        }

        #hamburgerMenu.open {
            transform: translateX(0);
        }

        #hamburgerOverlay.show {
            display: block;
        }

        body.menu-open {
            overflow: hidden;
        }

        .swiper-container {
            padding: 0 clamp(0.5rem, 2vw, 1rem);
        }

        .swiper-slide {
            width: auto;
        }

        .promotion-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #ef4444;
            color: white;
            font-size: clamp(0.6rem, 1.5vw, 0.65rem);
            padding: 4px 8px;
            border-radius: 9999px;
        }

        main {
            max-width: 100%;
            width: 100%;
            padding: clamp(0.5rem, 2vw, 1rem);
            box-sizing: border-box;
        }

        .grid {
            display: grid;
            gap: clamp(0.5rem, 2vw, 1rem);
            justify-content: center;
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(209, 213, 219, 0.3);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .input-glass:focus {
            border-color: #667eea;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.2);
        }

        .floating-label {
            position: relative;
        }

        .floating-label label {
            position: absolute;
            top: 50%;
            left: 12px;
            transform: translateY(-50%);
            transition: all 0.2s;
            color: #6b7280;
            font-size: clamp(12px, 2vw, 14px);
            pointer-events: none;
        }

        .floating-label input:not(:placeholder-shown) + label,
        .floating-label textarea:not(:placeholder-shown) + label {
            top: -8px;
            left: 8px;
            font-size: clamp(10px, 1.5vw, 12px);
            background: #fff;
            padding: 0 4px;
            color: #667eea;
        }

        @media (prefers-color-scheme: dark) {
            body, .bg-gray-50 {
                background: #1a1a1a !important;
                color: #ffffff !important;
            }

            header {
                background: #1a1a1a !important;
                color: #ffffff !important;
            }

            .glass-card {
                background: rgba(30, 30, 30, 0.95) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                color: #ffffff !important;
            }

            .restaurant-card {
                background: #2d2d2d !important;
                color: #ffffff !important;
                border: 1px solid #404040;
            }

            .restaurant-card h3 {
                color: #ffffff !important;
            }

            .restaurant-card p {
                color: #cccccc !important;
            }

            .restaurant-card .text-sm {
                color: #999999 !important;
            }

            .restaurant-card.closed {
                background: #1a1a1a !important;
                color: #666666 !important;
            }

            .search-input {
                background: #2d2d2d !important;
                border-color: #404040 !important;
                color: #ffffff !important;
            }

            .search-input::placeholder {
                color: #999999 !important;
            }

            .btn-toggle {
                background: #2d2d2d !important;
                color: #ffffff !important;
                border: 1px solid #404040;
            }

            .btn-toggle:hover {
                background: #404040 !important;
            }

            .address-dropdown {
                background: #2d2d2d !important;
                border: 1px solid #404040 !important;
                color: #ffffff !important;
            }

            .loading-spinner {
                border-color: #404040 !important;
                border-top-color: #667eea !important;
            }

            .header-logo {
                color: #ffffff !important;
            }

            #hamburgerMenu {
                background: #2d2d2d !important;
                color: #ffffff !important;
            }

            #hamburgerMenu nav a {
                color: #ffffff !important;
            }

            #hamburgerMenu nav a:hover {
                color: #667eea !important;
            }

            .address-btn,
            .account-btn {
                background: #2d2d2d !important;
                color: #ffffff !important;
                border-color: #404040 !important;
            }

            .address-btn:hover,
            .account-btn:hover {
                background: #404040 !important;
            }

            #addressDropdown,
            .group-hover\:block {
                background: #2d2d2d !important;
                border-color: #404040 !important;
            }

            #addressDropdown .adres-dropdown {
                color: #cccccc !important;
            }

            #addressDropdown .text-xs {
                color: #999999 !important;
            }

            #addressDropdown .teslimat-adresi {
                color: #cccccc !important;
            }

            h1, h2, h3, h4, h5, h6 {
                color: #ffffff !important;
            }

            p, span, div {
                color: #ffffff !important;
            }

            .address-item .font-medium,
            .address-item .text-xs {
                color: #cccccc !important;
            }

            .text-gray-600 {
                color: #cccccc !important;
            }

            .text-gray-500 {
                color: #999999 !important;
            }

            .text-gray-400 {
                color: #666666 !important;
            }

            .text-gray-700, .text-gray-800, .text-gray-900 {
                color: #ffffff !important;
            }

            footer {
                background: #1a1a1a !important;
                color: #ffffff !important;
            }

            nav {
                background: #1a1a1a !important;
                color: #ffffff !important;
            }

            input, textarea, select {
                background: #2d2d2d !important;
                color: #ffffff !important;
                border-color: #404040 !important;
            }

            a {
                color: #667eea !important;
            }

            a:hover {
                color: #5a6dd8 !important;
            }

            svg {
                color: inherit !important;
            }

            #basketPanel {
                background: #262121 !important;
                color: #ffffff !important;
            }

            #basketPanel h2 {
                color: #F97316 !important;
            }

            #restaurantName {
                color: #ffffff !important;
            }

            #basketPanel h3 {
                color: #ffffff !important;
            }

            #basketContainer, #basketSummary {
                background: #2d2d2d !important;
                border: 1px solid #404040 !important;
            }

            .quantity-display {
                color: #ffffff !important;
            }

            #searchSuggestions {
                background: #2d2d2d !important;
                border-color: #404040 !important;
                color: #ffffff !important;
            }

            .feature {
                color: #ffffff !important;
            }

            .feature h3 {
                color: #ffffff !important;
            }

            .feature p {
                color: #cccccc !important;
            }

            .bg-green-100 {
                background: rgba(34, 197, 94, 0.2) !important;
            }

            .bg-red-100 {
                background: rgba(239, 68, 68, 0.2) !important;
            }

            .bg-yellow-100 {
                background: rgba(251, 191, 36, 0.2) !important;
            }

            .text-green-600 {
                color: #22c55e !important;
            }

            .text-red-600 {
                color: #ef4444 !important;
            }

            .text-yellow-600 {
                color: #eab308 !important;
            }
        }

        @media (max-width: 1024px) {
            .hero-section h1 {
                font-size: clamp(1.5rem, 4vw, 1.875rem);
            }

            .hero-section p {
                font-size: clamp(0.75rem, 2vw, 0.875rem);
            }

            .restaurant-card {
                max-width: 18rem;
                min-height: 11.5rem;
            }

            .restaurant-card img {
                height: 7rem;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: clamp(0.5rem, 2vw, 0.75rem) clamp(0.75rem, 2.5vw, 1rem);
            }

            .header-logo {
                font-size: clamp(1rem, 3vw, 1.25rem);
            }

            .search-input {
                font-size: clamp(12px, 2vw, 14px);
                padding: clamp(0.5rem, 2vw, 0.75rem) clamp(0.75rem, 2.5vw, 1rem) clamp(0.5rem, 2vw, 0.75rem) clamp(2rem, 5vw, 2.5rem);
            }

            .search-input + svg {
                width: clamp(12px, 2vw, 14px);
                height: clamp(12px, 2vw, 14px);
                left: clamp(0.5rem, 2vw, 0.75rem);
            }

            .address-dropdown {
                width: 100%;
                max-width: clamp(14rem, 90%, 16rem);
            }

            .hero-section {
                padding: clamp(1.5rem, 4vw, 2rem) 0;
            }

            .hero-section h1 {
                font-size: clamp(1.25rem, 3.5vw, 1.5rem);
            }

            .hero-section p {
                font-size: clamp(0.65rem, 2vw, 0.75rem);
            }

            .hero-section .flex {
                flex-direction: column;
                gap: clamp(0.25rem, 2vw, 0.5rem);
            }

            .restaurant-card {
                max-width: 100%;
                min-height: 10rem;
            }

            .restaurant-card img {
                height: 6rem;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }

            footer {
                padding: clamp(0.75rem, 2vw, 1rem) 0;
            }

            footer .text-xl {
                font-size: clamp(1rem, 3vw, 1.25rem);
            }

            footer .space-x-4 {
                flex-direction: column;
                gap: clamp(0.25rem, 2vw, 0.5rem);
            }

            .flex.gap-8 {
                flex-direction: column;
                gap: clamp(1rem, 3vw, 1.5rem);
            }

            .glass-card {
                padding: clamp(1rem, 3vw, 1.5rem);
            }

            .address-card {
                padding: clamp(0.75rem, 2vw, 1rem);
            }

            #editAddressModal .glass-card {
                max-width: clamp(280px, 90%, 360px);
            }
        }

        @media (max-width: 480px) {
            .search-input {
                width: 100%;
            }

            .header-buttons {
                flex-direction: column;
                gap: clamp(0.25rem, 2vw, 0.5rem);
            }

            .address-btn,
            .account-btn,
            .cart-btn {
                width: 100%;
                justify-content: center;
                padding: clamp(8px, 2.5vw, 10px) clamp(12px, 3vw, 16px);
                font-size: clamp(12px, 2vw, 14px);
            }

            .restaurant-card {
                max-width: 100%;
                min-height: 9rem;
            }

            .restaurant-card img {
                height: 5rem;
            }

            .notification {
                width: clamp(80%, 90%, 95%);
                font-size: clamp(11px, 2vw, 12px);
            }

            #basketPanel {
                width: clamp(260px, 90%, 320px);
            }

            .address-card h3 {
                font-size: clamp(12px, 2vw, 14px);
            }

            .address-card p {
                font-size: clamp(10px, 1.5vw, 11px);
            }
        }

        @media (min-width: 769px) {
            .header-buttons {
                display: flex !important;
            }

            #hamburgerBtn, #mobileCartBtn {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen text-gray-900 flex flex-col">
    <header class="glass-card shadow-lg sticky top-0 z-40 transform transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center gap-2">
            <div class="flex items-center justify-between w-full md:w-auto">
                <button id="hamburgerBtn" class="md:hidden flex items-center p-2" aria-label="Men√ºy√º a√ß">
                    <i class="fas fa-bars text-2xl text-gray-700"></i>
                </button>
                <a href="/user/usermain"
                    class="header-logo text-2xl font-bold text-gray-800 hover:text-indigo-600 transition-all duration-300 flex items-center">
                    <i class="fas fa-utensils mr-2 text-orange-500 animate-pulse-fast"></i>eduyemek
                </a>
            </div>
            <div class="flex-1 w-full md:mx-4">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="Restoran, mutfak veya yemek ara..."
                        class="search-input w-full px-5 py-2 pl-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 text-gray-700 shadow-sm transition-all duration-300"
                        aria-label="Restoran veya yemek ara" />
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <div id="searchSuggestions"
                        class="absolute top-full left-0 w-full bg-white border border-gray-200 rounded-b-lg shadow-xl z-50 hidden overflow-hidden transition-all duration-300 ease-in-out origin-top">
                    </div>
                </div>
            </div>
            <div class="header-buttons hidden md:flex items-center space-x-3 w-full md:w-auto flex-wrap justify-center gap-2">
                <div class="relative w-full md:w-auto">
                    <button id="addressBtn"
                        class="address-btn flex items-center space-x-1 bg-white px-4 py-2 rounded-full text-gray-800 border border-gray-200 hover:border-indigo-300 hover:shadow-md transition-all duration-300 w-full md:w-auto justify-center group"
                        aria-label="Teslimat adresini se√ß" aria-expanded="false">
                        <svg class="w-4 h-4 text-indigo-500 group-hover:text-indigo-600 transition-colors duration-300" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span id="selectedAddress" class="font-medium">Adres Se√ßin</span>
                        <svg class="w-3 h-3 text-gray-500 transform group-hover:rotate-180 transition-transform duration-300"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="addressDropdown"
                        class="address-dropdown absolute hidden mt-1 w-full md:w-64 rounded-lg shadow-md z-50">
                        <div class="p-3">
                            <div class="teslimat-adresi text-xs font-semibold text-gray-700 mb-2">Teslimat Adresi</div>
                            <ul id="addressList" class="space-y-1"></ul>
                        </div>
                    </div>
                </div>
                <div class="relative inline-block text-left group w-full md:w-auto">
                    <a href="/user/usermain/account">
                        <button
                            class="account-btn flex items-center space-x-1 bg-white px-4 py-2 rounded-full text-gray-800 border border-gray-200 hover:bg-gray-50 hover:shadow-md transition-all duration-300 w-full md:w-auto justify-center"
                            aria-label="Hesap men√ºs√ºn√º a√ß" aria-expanded="false">
                            <svg class="w-4 h-4 text-indigo-500 transition-colors duration-300" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <span class="font-medium">Hesabƒ±m</span>
                            <svg class="w-3 h-3 text-gray-500 transform group-hover:rotate-180 transition-transform duration-300"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                    </a>
                    <div class="absolute left-0 top-full w-full h-3 z-40"></div>
                    <div
                        class="absolute left-0 mt-2 w-full md:w-48 glass-card border border-gray-200 rounded-lg shadow-xl z-50 hidden group-hover:block origin-top transform transition-all duration-300 ease-out scale-y-0 opacity-0 group-hover:scale-y-100 group-hover:opacity-100">
                        <a href="/user/usermain/orders"
                            class="block px-4 py-2 text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 rounded-t-lg text-sm transition-colors duration-200 relative">
                            Sipari≈ülerim
                            <span id="orderBadge"
                                class="notification-badge absolute top-2 right-2 w-4 h-4 text-xs rounded-full hidden"></span>
                        </a>
                        <a href="/user/usermain/addresses"
                            class="block px-4 py-2 text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 text-sm transition-colors duration-200">Adreslerim</a>
                        <a href="/user/usermain/userinfo"
                            class="block px-4 py-2 text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 text-sm transition-colors duration-200">Kullanƒ±cƒ±
                            Bilgilerim</a>
                        <a href="/" onclick="logout()"
                            class="block px-4 py-2 text-red-600 hover:bg-red-50 hover:text-red-700 rounded-b-lg text-sm transition-colors duration-200">√áƒ±kƒ±≈ü
                            Yap</a>
                    </div>
                </div>
                <button onclick="toggleBasketPanel(true)"
                    class="cart-btn flex items-center space-x-2 btn-secondary px-4 py-2 rounded-full font-semibold w-full md:w-auto justify-center hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4m.6 10a1 1 0 102 0 1 1 0 00-2 0zm10 0a1 1 0 102 0 1 1 0 00-2 0z" />
                    </svg>
                    <span>Sepetim</span>
                    <% if (cartCount > 0) { %>
                        <div
                            class="notification-badge absolute -top-1 -right-1 bg-red-500 w-5 h-5 text-white text-xs font-bold rounded-full flex items-center justify-center animate-bounce-once">
                            <%= cartCount %>
                        </div>
                    <% } %>
                </button>
            </div>
        </div>
    </header>

    <div id="hamburgerMenu"
        class="fixed top-0 left-0 w-3/4 max-w-sm h-full bg-white shadow-xl transform -translate-x-full transition-transform duration-300 z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold text-purple-600">Men√º</h2>
            <button id="closeHamburgerBtn" class="absolute top-4 right-4 text-gray-500 hover:text-red-500"
                aria-label="Men√ºy√º kapat">‚úñ</button>
        </div>
        <nav class="p-4 space-y-2">
            <a href="/user/usermain" class="block text-gray-700 hover:text-indigo-600 relative">
                Ana Sayfa
                <span class="notification-badge absolute top-1 right-2 w-4 h-4 text-xs rounded-full hidden"></span>
            </a>
            <a href="/user/usermain/account" class="block text-gray-700 hover:text-indigo-600 relative">
                Hesabƒ±m
                <span class="notification-badge absolute top-1 right-2 w-4 h-4 text-xs rounded-full hidden"></span>
            </a>
            <a href="/user/usermain/orders" class="block text-gray-700 hover:text-indigo-600 relative">
                Sipari≈ülerim
                <span id="mobileOrderBadge"
                    class="notification-badge absolute top-1 right-2 w-4 h-4 text-xs rounded-full hidden"></span>
            </a>
            <a href="/user/usermain/addresses" class="block text-gray-700 hover:text-indigo-600">Adreslerim</a>
            <a href="/user/usermain/userinfo" class="block text-gray-700 hover:text-indigo-600 relative">
                Kullanƒ±cƒ± Bilgilerim
                <span class="notification-badge absolute top-1 right-2 w-4 h-4 text-xs rounded-full hidden"></span>
            </a>
            <a href="/" onclick="logout()" class="block text-red-600 hover:text-red-700">√áƒ±kƒ±≈ü Yap</a>
        </nav>
    </div>
    <div id="hamburgerOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <button id="mobileCartBtn"
        class="fixed bottom-4 right-4 md:hidden btn-secondary p-4 rounded-full shadow-lg flex items-center justify-center z-30"
        aria-label="Sepeti a√ß">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 3h2l.4 2M7 13h10l4-8H5.4m.6 10a1 1 0 102 0 1 1 0 00-2 0zm10 0a1 1 0 102 0 1 1 0 00-2 0z" />
        </svg>
        <% if (cartCount > 0) { %>
            <span
                class="notification-badge absolute -top-2 -right-2 w-6 h-6 text-xs font-bold rounded-full flex items-center justify-center">
                <%= cartCount %>
            </span>
        <% } %>
    </button>

    <div class="min-h-screen py-4 px-2 relative z-10">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8 animate-fade-in">
                <h1 class="text-3xl font-bold text-gray-800">üìç Adreslerim</h1>
                <p class="text-gray-600 text-base mt-1">Teslimat adreslerinizi kolayca y√∂netin</p>
            </div>

            <div class="flex gap-8">
                <div class="flex flex-col gap-4 flex-1">
                    <div
                        class="glass-card p-6 animate-fade-in shadow-xl border-2 border-gray-400 border-opacity-40 w-full">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">‚úÖ Se√ßili Adresim</h2>
                        <div id="selectedAddressContainer" class="space-y-3">
                            <% if (selectedAddress) { %>
                                <div class="address-card p-4 animate-fade-in">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="text-base font-medium text-gray-800 mb-1 flex items-center">
                                                <span class="mr-2">üè†</span>
                                                <%= selectedAddress.title %>
                                            </h3>
                                            <p class="text-xs text-gray-500">
                                                <%= selectedAddress.address %>
                                            </p>
                                            <div class="flex items-center text-xs text-gray-500 mt-1">
                                            </div>
                                        </div>
                                        <div class="ml-3 flex space-x-2">
                                        </div>
                                    </div>
                                </div>
                            <% } else { %>
                                <div class="address-empty">
                                    <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    <p>Hen√ºz se√ßili bir adresiniz bulunmamaktadƒ±r.</p>
                                    <p class="text-xs mt-1 opacity-75">A≈üaƒüƒ±dan bir adres se√ßebilir veya yeni bir
                                        adres
                                        ekleyebilirsiniz.</p>
                                </div>
                            <% } %>
                        </div>
                    </div>

                    <div
                        class="glass-card p-6 flex-1 animate-fade-in shadow-xl border-2 border-gray-400 border-opacity-40 flex flex-col right-box w-full">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center gap-2">‚ûï Yeni Adres Ekle</h2>
                        <form id="addressForm" action="/user/usermain/saveaddress" method="POST"
                            class="space-y-4 flex-grow">
                            <div class="form-group floating-label">
                                <input type="text" id="title" name="title" placeholder=" " required
                                    class="input-glass w-full rounded-lg px-4 py-2 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-200" />
                                <label for="title">Adres Ba≈ülƒ±ƒüƒ±</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="text" id="address" name="address" placeholder=" " required
                                    class="input-glass w-full rounded-lg px-4 py-2 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-200" />
                                <label for="address">Adres Detaylarƒ±</label>
                            </div>
                            <button type="submit"
                                class="btn-primary w-full py-2 px-4 text-base font-bold focus:outline-none focus:ring-4 focus:ring-purple-600 transition">
                                Adresi Kaydet
                            </button>
                        </form>
                    </div>
                </div>
                <div
                    class="glass-card p-6 flex-1 animate-fade-in shadow-xl border-2 border-gray-400 border-opacity-40 flex flex-col">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">üè† Kayƒ±tlƒ± Adreslerim</h2>
                    <div id="addressList" class="space-y-3 flex-1 overflow-auto">
                        <% if (addresses && addresses.length > 0) { %>
                            <% addresses.forEach((addr, index) => { %>
                                <div class="address-card p-4 animate-fade-in" data-address-id="<%= addr._id %>">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="text-base font-medium text-gray-800 mb-1 flex items-center">
                                                <span class="mr-2">üè†</span>
                                                <%= addr.title %>
                                            </h3>
                                            <p class="text-xs text-gray-500">
                                                <%= addr.address %>
                                            </p>
                                            <div class="flex items-center text-xs text-gray-500 mt-1">
                                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 4v10a2 2 0 002 2h4a2 2 0 002-2V11m-6 0h8" />
                                                </svg>
                                                <%= new Date(addr.createdAt).toLocaleDateString('tr-TR', {
                                                    day: 'numeric', month: 'long', year: 'numeric' }) %>
                                            </div>
                                        </div>
                                        <div class="ml-3 flex space-x-2 flex-wrap gap-2">
                                            <button onclick="selectAddress('<%= addr._id %>')"
                                                class="btn-primary px-3 py-1 rounded text-sm">
                                                <i class="fas fa-check mr-1"></i> Se√ß
                                            </button>
                                            <button
                                                onclick="openEditModal('<%= addr._id %>', '<%= addr.title %>', `<%= addr.address %>`)"
                                                class="btn-secondary px-3 py-1 rounded text-sm">
                                                <i class="fas fa-edit mr-1"></i> D√ºzenle
                                            </button>
                                            <form action="/user/usermain/deleteaddress" method="POST">
                                                <input type="hidden" name="addressId" value="<%= addr._id %>">
                                                <button type="submit" class="btn-third px-3 py-1 rounded text-sm"
                                                    onclick="return confirm('Bu adresi silmek istediƒüinize emin misiniz?')">
                                                    <i class="fas fa-trash mr-1"></i> Sil
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        <% } else { %>
                            <div class="address-empty">
                                <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <p>Hen√ºz kayƒ±tlƒ± adresiniz bulunmamaktadƒ±r.</p>
                                <p class="text-xs mt-1 opacity-75">Yukarƒ±daki formu kullanarak yeni bir
                                    adres
                                    ekleyebilirsiniz.</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="editAddressModal"
        class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
        <div class="glass-card p-6 w-full max-w-md rounded-lg shadow-xl border border-white border-opacity-60">
            <div class="flex items-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800">‚úèÔ∏è Adresi D√ºzenle</h2>
            </div>
            <form id="editAddressForm" action="/user/usermain/editaddress" method="POST" class="space-y-4">
                <input type="hidden" id="editAddressId" name="addressId">
                <div class="floating-label">
                    <input type="text" id="editTitle" name="title" placeholder=" " required
                        class="input-glass border border-purple-500 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-600 transition w-full">
                    <label for="editTitle">Adres Ba≈ülƒ±ƒüƒ±</label>
                </div>
                <div class="floating-label">
                    <textarea id="editAddress" name="address" placeholder=" " rows="3" required
                        class="input-glass border border-purple-500 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-600 transition w-full"></textarea>
                    <label for="editAddress">Adres Detaylarƒ±</label>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1 py-2 px-4 text-base font-bold">Kaydet</button>
                    <button type="button" id="cancelEdit"
                        class="btn-secondary flex-1 py-2 px-4 text-base font-bold">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>

    <div id="basketOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden" onclick="toggleBasketPanel(false)">
    </div>
    <div id="basketPanel"
        class="fixed top-0 right-0 w-full max-w-md h-full bg-white shadow-xl transform translate-x-full transition-transform duration-300 z-40 overflow-y-auto">
        <div class="p-4 border-b relative flex items-center">
            <h2 class="text-xl font-bold text-purple-600 mx-auto">Sepetiniz</h2>
            <button id="closeBasketBtn" class="absolute right-4 text-gray-500 hover:text-red-500 text-1xl font-bold"
                aria-label="Sepeti kapat">‚ùå</button>
        </div>
        <main class="px-4 py-6">
            <div id="basketStats" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 animate-fade-in"></div>
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
                <div id="restaurantInfo" class="p-4 border-b border-gray-200 hidden">
                    <h2 class="text-lg font-semibold text-orange-600">Restoran: <span id="restaurantName"
                            class="text-gray-900"></span></h2>
                </div>
                <div id="basketContainer" class="p-4"></div>
            </div>
            <div id="basketSummary" class="bg-white rounded-xl shadow-lg p-4 hidden">
                <h3 class="text-base font-semibold text-purple-600 mb-2">Sipari≈ü √ñzeti</h3>
                <div class="space-y-1 text-gray-600 text-sm">
                    <div class="flex justify-between">
                        <span>Ara Toplam:</span>
                        <span id="subtotal"></span>
                    </div>
                    <hr class="my-2">
                    <div class="flex justify-between font-semibold text-gray-800">
                        <span>Toplam:</span>
                        <span id="finalTotal" class="text-orange-500"></span>
                    </div>
                </div>
            </div>
            <button id="confirmBasketBtn"
                class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold px-4 py-2 rounded mt-4 hidden"
                aria-label="Sepeti onayla">Sepeti Onayla</button>
        </main>
    </div>

    <script>
        function getToken() {
            return document.cookie.split('; ').find(row => row.startsWith('token='))?.split('=')[1] || null;
        }

        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'error' : type === 'info' ? 'info' : 'success'}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        function toggleSpinner(show) {
            const spinner = document.getElementById('spinner');
            if (spinner) spinner.style.display = show ? 'block' : 'none';
        }

        function setupHamburgerMenu() {
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            const hamburgerOverlay = document.getElementById('hamburgerOverlay');
            const closeHamburgerBtn = document.getElementById('closeHamburgerBtn');

            if (!hamburgerBtn || !hamburgerMenu || !hamburgerOverlay || !closeHamburgerBtn) return;

            hamburgerBtn.addEventListener('click', () => {
                hamburgerMenu.classList.add('open');
                hamburgerOverlay.classList.add('show');
                document.body.classList.add('menu-open');
                hamburgerBtn.setAttribute('aria-expanded', 'true');
                document.querySelector('.header-buttons').classList.remove('show');
            });

            closeHamburgerBtn.addEventListener('click', () => {
                hamburgerMenu.classList.remove('open');
                hamburgerOverlay.classList.remove('show');
                document.body.classList.remove('menu-open');
                hamburgerBtn.setAttribute('aria-expanded', 'false');
            });

            hamburgerOverlay.addEventListener('click', () => {
                hamburgerMenu.classList.remove('open');
                hamburgerOverlay.classList.remove('show');
                document.body.classList.remove('menu-open');
                hamburgerBtn.setAttribute('aria-expanded', 'false');
            });

            hamburgerMenu.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    hamburgerMenu.classList.remove('open');
                    hamburgerOverlay.classList.remove('show');
                    document.body.classList.remove('menu-open');
                    hamburgerBtn.setAttribute('aria-expanded', 'false');
                    hamburgerBtn.focus();
                }
            });
        }

        function setupBasketPanel() {
            const basketPanel = document.getElementById('basketPanel');
            const basketOverlay = document.getElementById('basketOverlay');
            const closeBasketBtn = document.getElementById('closeBasketBtn');
            const cartBtn = document.querySelector('.cart-btn');
            const mobileCartBtn = document.getElementById('mobileCartBtn');
            const confirmBasketBtn = document.getElementById('confirmBasketBtn');

            if (!basketPanel || !basketOverlay || !closeBasketBtn || !cartBtn || !mobileCartBtn || !confirmBasketBtn) return;

            window.toggleBasketPanel = function (show) {
                if (show) {
                    basketPanel.classList.remove('translate-x-full');
                    basketPanel.classList.add('translate-x-0');
                    basketOverlay.classList.remove('hidden');
                    loadBasketItems();
                } else {
                    basketPanel.classList.remove('translate-x-0');
                    basketPanel.classList.add('translate-x-full');
                    basketOverlay.classList.add('hidden');
                }
            };

            basketPanel.addEventListener('click', (e) => e.stopPropagation());
            closeBasketBtn.addEventListener('click', () => toggleBasketPanel(false));
            cartBtn.addEventListener('click', () => toggleBasketPanel(true));
            mobileCartBtn.addEventListener('click', () => toggleBasketPanel(true));

            confirmBasketBtn.addEventListener('click', () => {
                window.location.href = '/user/usermain/checkout';
            });

            basketPanel.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    toggleBasketPanel(false);
                    cartBtn.focus();
                }
            });
        }

        async function loadBasketItems() {
            const basketStats = document.getElementById('basketStats');
            const restaurantInfo = document.getElementById('restaurantInfo');
            const basketContainer = document.getElementById('basketContainer');
            const basketSummary = document.getElementById('basketSummary');
            const confirmBasketBtn = document.getElementById('confirmBasketBtn');
            const mobileCartBadge = document.querySelector('#mobileCartBtn .notification-badge');

            if (!basketContainer) return;

            basketContainer.innerHTML = '<p class="text-sm text-gray-400">Y√ºkleniyor...</p>';

            try {
                const res = await fetch('/basket/adds', { headers: { 'Accept': 'application/json' } });
                if (!res.ok) {
                    const errorData = await res.json();
                    throw new Error(errorData.message || `Sepet bilgileri y√ºklenemedi: ${res.status}`);
                }
                const data = await res.json();

                if (!data.basket || !data.basket.items || data.basket.items.length === 0) {
                    basketStats.innerHTML = '';
                    restaurantInfo.classList.add('hidden');
                    basketContainer.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-shopping-cart text-4xl text-orange-500 mb-4"></i>
                            <h3 class="text-xl font-medium text-gray-500 mb-2">Sepetiniz bo≈ü</h3>
                            <p class="text-gray-400">Restorana geri d√∂nerek √ºr√ºn ekleyebilirsiniz.</p>
                        </div>`;
                    basketSummary.classList.add('hidden');
                    confirmBasketBtn.classList.add('hidden');
                    updateCartBadge(0);
                    if (mobileCartBadge) mobileCartBadge.classList.add('hidden');
                    return;
                }

                const { items, itemCount, totalQuantity, totalPrice, restaurantName } = data.basket;

                restaurantInfo.classList.remove('hidden');
                document.getElementById('restaurantName').textContent = restaurantName;

                basketContainer.innerHTML = '';
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-purple-50 transition-colors duration-200';
                    div.innerHTML = `
                        <div class="flex items-center gap-4 flex-1">
                            <div class="w-16 h-16 rounded-lg overflow-hidden shadow-md">
                                <img src="/Uploads/lahmacun.png" alt="${item.name}" class="w-full h-full object-cover" loading="lazy" />
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">${item.name}</h3>
                                <p class="text-gray-600">Birim Fiyat: ${item.price.toFixed(2)}‚Ç∫</p>
                                <p class="text-sm text-gray-500">Toplam: ${(item.price * item.quantity).toFixed(2)}‚Ç∫</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="flex items-center gap-2 bg-white rounded-lg border border-gray-300 px-3 py-2">
                                <button class="quantity-btn decrease-btn text-red-500 hover:text-red-700 font-bold text-lg w-6 h-6 flex items-center justify-center hover:bg-red-50 rounded transition-colors duration-200" data-meal-id="${item.mealId}" data-action="decrease" aria-label="Miktarƒ± azalt">‚àí</button>
                                <span class="quantity-display mx-3 font-semibold text-gray-800 min-w-[2rem] text-center">${item.quantity}</span>
                                <button class="quantity-btn increase-btn text-green-500 hover:text-green-700 font-bold text-lg w-6 h-6 flex items-center justify-center hover:bg-green-50 rounded transition-colors duration-200" data-meal-id="${item.mealId}" data-action="increase" aria-label="Miktarƒ± artƒ±r">+</button>
                            </div>
                            <button class="remove-item-btn text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-full transition-colors duration-200" data-meal-id="${item.mealId}" title="Sepetten Kaldƒ±r" aria-label="√úr√ºn√º sepetten kaldƒ±r">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    basketContainer.appendChild(div);
                });

                document.querySelectorAll('.quantity-btn').forEach(button => {
                    button.addEventListener('click', async () => {
                        const mealId = button.dataset.mealId;
                        const action = button.dataset.action;
                        await updateBasket(mealId, action);
                    });
                });

                document.querySelectorAll('.remove-item-btn').forEach(button => {
                    button.addEventListener('click', async () => {
                        const mealId = button.dataset.mealId;
                        await updateBasket(mealId, 'remove');
                    });
                });

                basketSummary.classList.remove('hidden');
                document.getElementById('subtotal').textContent = `${totalPrice.toFixed(2)}‚Ç∫`;
                document.getElementById('finalTotal').textContent = `${totalPrice.toFixed(2)}‚Ç∫`;

                confirmBasketBtn.classList.remove('hidden');
                updateCartBadge(totalQuantity);
                if (mobileCartBadge) {
                    mobileCartBadge.textContent = totalQuantity;
                    mobileCartBadge.classList.toggle('hidden', totalQuantity === 0);
                }
            } catch (err) {
                basketContainer.innerHTML = '<p class="text-sm text-red-500">Sepet y√ºklenemedi.</p>';
                console.error(err);
                showNotification(err.message || 'Sepet y√ºklenirken hata olu≈ütu.', 'error');
            }
        }

        async function updateBasket(mealId, action) {
            try {
                toggleSpinner(true);
                let endpoint = action === 'remove' ? '/basket/remove' : '/basket/update';
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mealId, action })
                });
                const data = await res.json();
                if (!res.ok) {
                    throw new Error(data.message || `Sepet g√ºncelleme hatasƒ±: ${res.status}`);
                }
                if (data.success) {
                    showNotification(action === 'remove' ? '√úr√ºn sepetten kaldƒ±rƒ±ldƒ±' : 'Sepet g√ºncellendi', 'success');
                    loadBasketItems();
                } else {
                    showNotification(data.message || 'Bir hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Hata:', error);
                showNotification(error.message || 'Sepet g√ºncellenirken hata olu≈ütu', 'error');
            } finally {
                toggleSpinner(false);
            }
        }

        function updateCartBadge(count) {
            const badge = document.querySelector('.cart-btn .notification-badge');
            if (badge) {
                badge.textContent = count;
                badge.classList.toggle('hidden', count === 0);
            }
        }

        async function loadAddresses() {
            try {
                const response = await fetch('/user/usermain/addresses', {
                    headers: { 'Accept': 'application/json', 'Authorization': `Bearer ${getToken()}` }
                });
                if (!response.ok) throw new Error('Adresler alƒ±namadƒ±');
                const { addresses, selectedAddressId } = await response.json();
                const addressList = document.getElementById('addressList');
                addressList.innerHTML = '';
                if (addresses.length === 0) {
                    addressList.innerHTML = '<li class="text-gray-500 text-sm">Kayƒ±tlƒ± adres bulunamadƒ±</li>';
                } else {
                    addresses.forEach(address => {
                        const li = document.createElement('li');
                        li.className = 'address-item px-2 py-2 rounded hover:bg-gray-100 cursor-pointer transition';
                        li.dataset.addressId = address._id;
                        li.tabIndex = 0;
                        li.innerHTML = `
                            <div class="font-medium text-sm">${address.title}</div>
                            <div class="adres-dropdown text-xs text-gray-500">${address.formatted_address}</div>
                        `;
                        if (address._id === selectedAddressId) {
                            li.classList.add('bg-blue-100');
                            document.getElementById('selectedAddress').textContent = address.title;
                        }
                        addressList.appendChild(li);
                    });
                }
            } catch (error) {
                console.error('Adresler alƒ±namadƒ±:', error);
                document.getElementById('addressList').innerHTML = '<li class="text-red-500 text-sm">Adresler y√ºklenemedi</li>';
                showNotification(error.message || 'Adresler y√ºklenirken hata olu≈ütu', 'error');
            }
        }

        function setupAddressDropdown() {
            const addressBtn = document.getElementById('addressBtn');
            const addressDropdown = document.getElementById('addressDropdown');
            const addressList = document.getElementById('addressList');
            const selectedAddress = document.getElementById('selectedAddress');

            if (!addressBtn || !addressDropdown || !addressList || !selectedAddress) return;

            addressBtn.addEventListener('click', () => {
                addressDropdown.classList.toggle('hidden');
                addressBtn.setAttribute('aria-expanded', addressDropdown.classList.contains('hidden') ? 'false' : 'true');
            });

            document.addEventListener('click', e => {
                if (!addressBtn.contains(e.target) && !addressDropdown.contains(e.target)) {
                    addressDropdown.classList.add('hidden');
                    addressBtn.setAttribute('aria-expanded', 'false');
                }
            });

            addressList.addEventListener('click', async e => {
                const addressItem = e.target.closest('.address-item');
                if (addressItem) {
                    const addressId = addressItem.dataset.addressId;
                    const addressTitle = addressItem.querySelector('.font-medium').textContent;
                    selectedAddress.textContent = addressTitle;
                    document.querySelectorAll('.address-item').forEach(item => item.classList.remove('bg-blue-100'));
                    addressItem.classList.add('bg-blue-100');
                    addressDropdown.classList.add('hidden');
                    addressBtn.setAttribute('aria-expanded', 'false');
                    try {
                        const response = await fetch('/user/usermain/selectaddress', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${getToken()}`
                            },
                            body: JSON.stringify({ addressId })
                        });
                        const data = await response.json();
                        if (data.message) {
                            showNotification('Adres se√ßildi!', 'success');
                            const addressCard = document.querySelector(`.address-card[data-address-id="${addressId}"]`);
                            if (addressCard) {
                                const title = addressCard.querySelector('h3').textContent.replace('üè†', '').trim();
                                const address = addressCard.querySelector('p').textContent.trim();
                                const selectedContainer = document.getElementById('selectedAddressContainer');
                                selectedContainer.innerHTML = `
                                    <div class="address-card p-4 animate-fade-in">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h3 class="text-base font-medium text-gray-800 mb-1 flex items-center">
                                                    <span class="mr-2">üè†</span>
                                                    ${title}
                                                </h3>
                                                <p class="text-xs text-gray-500">${address}</p>
                                                <div class="flex items-center text-xs text-gray-500 mt-1"></div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }
                        } else {
                            showNotification(data.error || 'Adres se√ßilemedi', 'error');
                        }
                    } catch (error) {
                        console.error('Adres se√ßme hatasƒ±:', error);
                        showNotification('Adres se√ßilirken hata olu≈ütu', 'error');
                    }
                }
            });

            addressList.addEventListener('keydown', e => {
                const items = Array.from(addressList.querySelectorAll('.address-item'));
                const current = document.activeElement;
                const index = items.indexOf(current);
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    const next = items[index + 1] || items[0];
                    next.focus();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    const prev = items[index - 1] || items[items.length - 1];
                    prev.focus();
                } else if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    current.click();
                }
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchSuggestions = document.getElementById('searchSuggestions');

            if (!searchInput || !searchSuggestions) return;

            searchInput.addEventListener('input', debounce(async e => {
                const query = e.target.value.trim();
                if (query.length > 0) {
                    try {
                        const response = await fetch(`/user/usermain/search?q=${encodeURIComponent(query)}`);
                        const suggestions = await response.json();
                        searchSuggestions.innerHTML = '';
                        suggestions.forEach(s => {
                            const div = document.createElement('div');
                            div.className = 'px-3 py-2 hover:bg-gray-100 cursor-pointer';
                            div.textContent = s.type === 'restaurant' ? `${s.name} (Restoran)` : `${s.name} (Restoran: ${s.restaurantName})`;
                            div.addEventListener('click', () => {
                                if (s.type === 'restaurant') {
                                    window.location.href = `/user/usermain/restaurant/${s.id}`;
                                } else if (s.type === 'meal') {
                                    window.location.href = `/user/usermain/restaurant/${s.restaurantId}`;
                                }
                            });
                            searchSuggestions.appendChild(div);
                        });
                        searchSuggestions.classList.remove('hidden');
                    } catch (error) {
                        console.error('Search error:', error);
                        showNotification('Arama √∂nerileri alƒ±namadƒ±', 'error');
                    }
                } else {
                    searchSuggestions.classList.add('hidden');
                }
            }, 100));

            searchInput.addEventListener('blur', () => {
                setTimeout(() => searchSuggestions.classList.add('hidden'), 150);
            });

            searchInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    const firstSuggestion = searchSuggestions.querySelector('div');
                    if (firstSuggestion) firstSuggestion.click();
                }
            });
        }

        function openEditModal(addressId, title, address) {
            document.getElementById('editAddressId').value = addressId;
            document.getElementById('editTitle').value = title;
            document.getElementById('editAddress').value = address;
            document.getElementById('editAddressModal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('editAddressModal').classList.add('hidden');
            document.getElementById('editAddressForm').reset();
        }

        function selectAddress(addressId) {
            fetch('/user/usermain/selectaddress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${getToken()}`
                },
                body: JSON.stringify({ addressId })
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Adres se√ßilemedi');
                    }
                })
                .then(data => {
                    if (data.message) {
                        const addressCard = document.querySelector(`.address-card[data-address-id="${addressId}"]`);
                        if (addressCard) {
                            const title = addressCard.querySelector('h3').textContent.replace('üè†', '').trim();
                            const address = addressCard.querySelector('p').textContent.trim();
                            const selectedContainer = document.getElementById('selectedAddressContainer');
                            selectedContainer.innerHTML = `
                                <div class="address-card p-4 animate-fade-in">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="text-base font-medium text-gray-800 mb-1 flex items-center">
                                                <span class="mr-2">üè†</span>
                                                ${title}
                                            </h3>
                                            <p class="text-xs text-gray-500">${address}</p>
                                            <div class="flex items-center text-xs text-gray-500 mt-1"></div>
                                        </div>
                                    </div>
                                </div>
                            `;
                            document.getElementById('selectedAddress').textContent = title;
                            document.querySelectorAll('.address-item').forEach(item => item.classList.remove('bg-blue-100'));
                            const dropdownItem = document.getElementById('addressList').querySelector(`[data-address-id="${addressId}"]`);
                            if (dropdownItem) dropdownItem.classList.add('bg-blue-100');
                            showNotification('Adres se√ßildi!', 'success');
                        } else {
                            showNotification('Adres se√ßilemedi', 'error');
                        }
                    }
                })
                .catch(error => {
                    console.error('Hata:', error);
                    showNotification(error.message || 'Adres se√ßilirken hata olu≈ütu.', 'error');
                });
        }

        async function logout() {
            try {
                const response = await fetch('/account/user/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                if (response.ok) {
                    window.location.href = '/';
                } else {
                    showNotification('√áƒ±kƒ±≈ü yapƒ±lamadƒ±.', 'error');
                }
            } catch (error) {
                console.error('Hata:', error);
                showNotification(error.message || 'Baƒülantƒ± hatasƒ±.', 'error');
            }
        }

        function handleQueryNotifications() {
            const urlParams = new URLSearchParams(window.location.search);
            const successMessage = urlParams.get('success');
            const errorMessage = urlParams.get('error');

            if (successMessage) {
                showNotification(decodeURIComponent(successMessage), 'success');
            } else if (errorMessage) {
                showNotification(decodeURIComponent(errorMessage), 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            setupHamburgerMenu();
            setupBasketPanel();
            setupAddressDropdown();
            setupSearch();
            await loadAddresses();
            handleQueryNotifications();

            document.getElementById('title').classList.add('input-glass');
            document.getElementById('address').classList.add('input-glass');
            document.getElementById('searchInput').classList.add('search-input');

            document.getElementById('cancelEdit').addEventListener('click', closeEditModal);

            new Swiper('.swiper-container', {
                slidesPerView: 'auto',
                spaceBetween: 8,
                freeMode: true,
            });

            let lastScrollY = window.scrollY;
            let ticking = false;

            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        const header = document.querySelector('header');
                        const currentScrollY = window.scrollY;

                        if (currentScrollY > 50) {
                            header.classList.add('shrunk');
                        } else {
                            header.classList.remove('shrunk');
                        }

                        lastScrollY = currentScrollY;
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js').catch(error => {
                    console.error('Service Worker kaydƒ± ba≈üarƒ±sƒ±z:', error);
                });
            }

            // Mobile header buttons toggle
            const headerButtons = document.querySelector('.header-buttons');
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            hamburgerBtn.addEventListener('click', () => {
                headerButtons.classList.toggle('show');
            });
        });

        window.addEventListener('resize', () => {
            const addressDropdown = document.getElementById('addressDropdown');
            const searchSuggestions = document.getElementById('searchSuggestions');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            const headerButtons = document.querySelector('.header-buttons');
            if (window.innerWidth < 768) {
                if (addressDropdown) addressDropdown.classList.add('hidden');
                if (searchSuggestions) searchSuggestions.classList.add('hidden');
                if (hamburgerMenu) hamburgerMenu.classList.remove('open');
                if (headerButtons) headerButtons.classList.remove('show');
                document.getElementById('hamburgerOverlay').classList.remove('show');
                document.body.classList.remove('menu-open');
            } else {
                if (headerButtons) headerButtons.classList.remove('show');
            }
        });
    </script>

    <footer class="glass-card shadow-inner mt-auto py-4 relative z-10">
        <div class="max-w-3xl mx-auto px-2">
            <div class="text-center">

                <!-- Ortalanmƒ±≈ü logo + gap -->
                <div
                    class="flex justify-center items-center text-base font-bold text-gray-800 hover:text-indigo-600 transition-all duration-300 cursor-pointer mb-2">
                    <i class="fas fa-utensils mr-2 text-orange-500 animate-pulse-fast"></i>
                    eduyemek
                </div>
                <div class="text-[10px] text-gray-500">¬© 2025 eduyemek - T√ºm haklarƒ± saklƒ±dƒ±r.</div>

            </div>
        </div>
    </footer>
</body>

</html>